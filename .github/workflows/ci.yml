name: ci
on:
  push:
  pull_request:
jobs:
  db_services:
    runs-on: ubuntu-latest
    services:
      postgres:
        image: postgres:16
        env:
          POSTGRES_USER: etl
          POSTGRES_PASSWORD: etl
          POSTGRES_DB: etldb
        ports: ["5432:5432"]
        options: >-
          --health-cmd "pg_isready -U etl"
          --health-interval 5s
          --health-timeout 5s
          --health-retries 20
      clickhouse:
        image: clickhouse/clickhouse-server:24.8
        ports: ["8123:8123", "9000:9000"]
        options: >-
          --health-cmd "bash -c 'echo \"SELECT 1\" | clickhouse-client || exit 1'"
          --health-interval 5s
          --health-timeout 5s
          --health-retries 20
    steps:
      - uses: actions/checkout@v4
      - run: echo "DB services are up âœ…"
